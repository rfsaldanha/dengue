---
title: "Dengue missing"
author: Raphael Saldanha
date: now
---

## Context

This report presents an missing data analysis for Brazilian dengue data, from the SINAN dataset, downloaded from the DataSUS FTP, covering the years from 2011 to 2021.

After the download, the data was pre-processed by using the `microdatasus` package as presented on the `dengue.qmd` report.

Considering the high number of variables, this report will use a subset of the most relevant ones.

## Packages

```{r}
library(tidyverse)
library(arrow)
library(naniar)
library(knitr)
library(lubridate)
```

## Load data

```{r}
important_vars <- c("ID_AGRAVO", "DT_NOTIFIC", "ID_UNIDADE",
                    "DT_SIN_PRI", "CS_SEXO", "CS_GESTANT",
                    "CS_RACA", "CS_ESCOL_N", "ID_MN_RESI",
                    "COUFINF", "COMUNINF", "ID_OCUPA_N",
                    "DT_SORO", "RESUL_SORO", "SOROTIPO", 
                    "CLASSI_FIN", "CRITERIO", "EVOLUCAO",
                    "DT_OBITO", "HOSPITALIZ", "DT_INTERNA")

dengue <- open_dataset(sources = "parquets/") %>%
  select(all_of(important_vars)) %>%
  collect()
```

## Overall

Plot with a 0.2% random sample (31,124 out from 15,562,124 records).

```{r}
dengue %>%
  slice_sample(prop = 0.002) %>%
  vis_miss()
```

Table considering all records.

```{r}
dengue %>% 
  miss_var_summary() %>%
  kable(
    format.args = list(big.mark = ".", decimal.mark = ",")
  )
```

### Variables quality

#### Residence municipality: ID_MN_RESI

Check var length. 6 characters are expected.

```{r}
dengue %>%
  mutate(
    ID_MN_RESI_check = if_else(nchar(ID_MN_RESI) == 6, 
                               false = FALSE,
                               true = TRUE)
  ) %>%
  group_by(ID_MN_RESI_check) %>%
  summarise(freq = n()) %>%
  ungroup() %>%
  kable(
    format.args = list(big.mark = ".", decimal.mark = ",")
  )


```

15.559.994 records on the database meets the criteria. 4 records have invalid municipalty codes and this information is missing for 2.126 records. Inputation from COMUNINF is a possibility.

#### Final classification of the notification: CLASSI_FIN

It is expected that the notifications final classification are labeled.

```{r}
dengue %>%
  group_by(CLASSI_FIN) %>%
  summarise(freq = n()) %>%
  ungroup() %>%
  kable(
    format.args = list(big.mark = ".", decimal.mark = ",")
  )
```

3 records have an invalid label and 69.866 are missing. This missing data may be from two causes: (1) the notification is being evaluated or (2) a real missing.

#### Date of the first symptons onset: DT_SIN_PRI

This is the date most near to the infection date and more relevant to epidemiological analysis.

```{r}
valid_interval <- interval(ymd("2001-01-01"), ymd("2021-12-31"))

dengue %>%
  mutate(
    DT_SIN_PRI_check = ymd(DT_SIN_PRI) %within% valid_interval
  ) %>%
  group_by(DT_SIN_PRI_check) %>%
  summarise(freq = n()) %>%
  ungroup() %>%
  kable(
    format.args = list(big.mark = ".", decimal.mark = ",")
  )
```

This variable is missing for 173 records. For 26.018 records, we have invalid dates (outside the period 2001-2021). It is possible to imputate with DT_NOTIFIC (date of notification), if valid.

## Session info

```{r}
sessionInfo()
```
