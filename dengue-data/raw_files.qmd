---
title: "Raw files"
author: Raphael Saldanha
date: last-modified
---

This notebook presents the process of downloading SINAN Dengue raw data files from DataSUS, preprocessing steps using the `{microdatasus}` package and exporting the raw files to `parquet` files.

Inputs: SINAN Dengue raw data files from DataSUS, with suspected cases of dengue.

Outputs: dengue suspected cases parquet files.

## Packages

```{r}
#| message: false
library(tidyverse)
# remotes::install_github("rfsaldanha/microdatasus")
library(microdatasus)
library(arrow)
```

## Data download

```{r}
# for(a in 2011:2021){
#   tmp <- fetch_datasus(
#     year_start = a, year_end = a,
#     information_system = "SINAN-DENGUE"
#   )
# 
#   write_parquet(x = tmp, sink = paste0("parquets_raw/raw_dengue_", a, ".parquet"))
#   
#   tmp <- process_sinan_dengue(data = tmp)
#   
#   write_parquet(x = tmp, sink = paste0("parquets/dengue_", a, ".parquet"))
#   
#   rm(tmp)
# }
```

::: callout-warning
This code chunk is commented to avoid unnecessary download again the raw DBC files from DataSUS.
:::

## Load

After download, preprocessing and export, the parquet files are ready to use.

```{r}
dengue <- open_dataset(sources = "parquets/")
```

```{r}
dengue %>% glimpse()
```

## Session info

```{r}
sessionInfo()
```
