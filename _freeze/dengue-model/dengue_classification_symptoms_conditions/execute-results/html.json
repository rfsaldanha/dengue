{
  "hash": "73e6abf002e5add3c724ec06298fc587",
  "result": {
    "markdown": "---\ntitle: \"Dengue case classification and symptons\"\nauthor: Raphael Saldanha\ndate: now\n---\n\n\n## Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(arrow)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'arrow'\n\nThe following object is masked from 'package:lubridate':\n\n    duration\n\nThe following object is masked from 'package:utils':\n\n    timestamp\n```\n:::\n\n```{.r .cell-code}\nlibrary(knitr)\nlibrary(lubridate)\nlibrary(tidymodels)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ────────────────────────────────────── tidymodels 1.1.0 ──\n✔ broom        1.0.5     ✔ rsample      1.1.1\n✔ dials        1.2.0     ✔ tune         1.1.1\n✔ infer        1.0.4     ✔ workflows    1.1.3\n✔ modeldata    1.1.0     ✔ workflowsets 1.0.1\n✔ parsnip      1.1.0     ✔ yardstick    1.2.0\n✔ recipes      1.0.6     \n── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──\n✖ scales::discard() masks purrr::discard()\n✖ dplyr::filter()   masks stats::filter()\n✖ recipes::fixed()  masks stringr::fixed()\n✖ dplyr::lag()      masks stats::lag()\n✖ yardstick::spec() masks readr::spec()\n✖ recipes::step()   masks stats::step()\n• Search for functions across packages at https://www.tidymodels.org/find/\n```\n:::\n\n```{.r .cell-code}\nlibrary(rpart.plot)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: rpart\n\nAttaching package: 'rpart'\n\nThe following object is masked from 'package:dials':\n\n    prune\n```\n:::\n\n```{.r .cell-code}\nlibrary(vip)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'vip'\n\nThe following object is masked from 'package:utils':\n\n    vi\n```\n:::\n:::\n\n\n## Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfiles_list <- c(\n  \"../dengue-data/parquets/dengue_2016.parquet\",\n  \"../dengue-data/parquets/dengue_2017.parquet\",\n  \"../dengue-data/parquets/dengue_2018.parquet\",\n  \"../dengue-data/parquets/dengue_2019.parquet\",\n  \"../dengue-data/parquets/dengue_2020.parquet\",\n  \"../dengue-data/parquets/dengue_2021.parquet\"\n)\n\nx_vars <- c(\"FEBRE\", \"MIALGIA\", \"CEFALEIA\", \"EXANTEMA\",\n         \"VOMITO\", \"NAUSEA\", \"DOR_COSTAS\", \"CONJUNTVIT\", \n         \"ARTRITE\", \"ARTRALGIA\", \"PETEQUIA_N\", \"LEUCOPENIA\", \n         \"LACO\", \"DOR_RETRO\", \"DIABETES\", \"HEMATOLOG\", \"HEPATOPAT\",\n         \"HEPATOPAT\", \"RENAL\", \"HIPERTENSA\", \"ACIDO_PEPT\",\n         \"AUTO_IMUNE\")\n\ndengue <- arrow::open_dataset(sources = files_list) %>%\n  select(all_of(c(\"CLASSI_FIN\", x_vars))) %>%\n  filter(CLASSI_FIN != \"Inconclusivo\") %>%\n  collect() %>%\n  mutate(CLASSI_FIN = as.factor(CLASSI_FIN)) %>%\n  mutate_at(.vars = x_vars, .funs = ~ . == \"Sim\")\n```\n:::\n\n\n## Model\n\n### Parameters\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntree_spec <- decision_tree() %>%\n  set_engine(\"rpart\") %>%\n  set_mode(\"classification\")\n```\n:::\n\n\n### Fit model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit1 <- tree_spec %>%\n  fit(CLASSI_FIN ~ ., data = sample_n(dengue, 10000) , model = TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfit1 %>% extract_fit_engine() %>%\n  rpart.plot(roundint = FALSE)\n```\n\n::: {.cell-output-display}\n![](dengue_classification_symptoms_conditions_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# augment(fit1, new_data = res_prep) %>%\n#     conf_mat(truth = anomaly, estimate = .pred_class)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# augment(fit1, new_data = res_prep) %>%\n#     accuracy(truth = anomaly, estimate = .pred_class)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# fit1 %>% \n#   extract_fit_engine() %>% \n#   vip()\n```\n:::\n",
    "supporting": [
      "dengue_classification_symptoms_conditions_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}