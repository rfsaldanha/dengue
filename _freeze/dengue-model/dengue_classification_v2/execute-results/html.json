{
  "hash": "69fc727668e85774751956362a041ed5",
  "result": {
    "markdown": "---\ntitle: \"Dengue case classification\"\nsubtitle: \"by symptoms and clinical condition\"\nauthor: Raphael Saldanha\ndate: last-modified\n---\n\n\nThe objective of this notebook is to train a model to reclassify inconclusive cases of dengue, zika and chikungunya based on the symptoms, clinical conditions and other patient related variables presented by confirmed and discarded cases\n\n## Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(arrow)\nlibrary(knitr)\nlibrary(lubridate)\nlibrary(tidymodels)\nlibrary(finetune)\nlibrary(bonsai)\nlibrary(tictoc)\nlibrary(vip)\nsource(\"../functions.R\")\n```\n:::\n\n\n## Data\n\n-   Cases classified as inconclusive are discarded for model training.\n\n### Dengue\n\n-   Data prior to 2016 does not have patient symptoms and clinical conditions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Data sources\nfiles_list <- c(\n  data_dir(\"dengue_data/parquets/dengue_2016.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2017.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2018.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2019.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2020.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2021.parquet\")\n)\n\n# Independent variables\nx_vars <- c(\"FEBRE\", \"MIALGIA\", \"CEFALEIA\", \n            \"EXANTEMA\", \"VOMITO\", \"NAUSEA\", \n            \"DOR_COSTAS\", \"CONJUNTVIT\", \n            \"ARTRITE\", \"ARTRALGIA\", \"PETEQUIA_N\", \n            \"LEUCOPENIA\", \"LACO\", \"DOR_RETRO\", \n            \"DIABETES\", \"HEMATOLOG\", \"HEPATOPAT\", \n            \"HEPATOPAT\", \"RENAL\", \"HIPERTENSA\",\n            \"ACIDO_PEPT\", \"AUTO_IMUNE\")\n\n# Prepare data\ndengue <- arrow::open_dataset(sources = files_list) %>%\n  # Select variables\n  select(all_of(c(\"CLASSI_FIN\", \"COMUNINF\", \"IDADEanos\", \"DT_SIN_PRI\", x_vars))) %>%\n  # Filter out \"Inconclusivo\" cases\n  filter(CLASSI_FIN != \"Inconclusivo\") %>%\n  # Collect data from parquet files\n  collect() %>%\n  # Prepare variables\n  mutate(CLASSI_FIN = case_when(\n    CLASSI_FIN != \"Descartado\" ~ \"Dengue\",\n    .default = \"Discarded\"\n  )) %>%\n  mutate(CLASSI_FIN = as.factor(CLASSI_FIN)) %>%\n  mutate(DT_SIN_PRI = as_date(DT_SIN_PRI)) %>%\n  mutate(COMUNINF = as.factor(COMUNINF)) %>%\n  mutate_at(.vars = x_vars, .funs = ~ . == \"Sim\") \n```\n:::\n\n\n\n### Chikungunya\n\n-   Data prior to 2017 does not have patient symptoms and clinical conditions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Data sources\nfiles_list <- c(\n  data_dir(\"chik_data/parquets/chik_2017.parquet\"),\n  data_dir(\"chik_data/parquets/chik_2018.parquet\"),\n  data_dir(\"chik_data/parquets/chik_2019.parquet\"),\n  data_dir(\"chik_data/parquets/chik_2020.parquet\"),\n  data_dir(\"chik_data/parquets/chik_2021.parquet\")\n)\n\n# Independent variables\nx_vars <- c(\"FEBRE\", \"MIALGIA\", \"CEFALEIA\", \n            \"EXANTEMA\", \"VOMITO\", \"NAUSEA\", \n            \"DOR_COSTAS\", \"CONJUNTVIT\", \n            \"ARTRITE\", \"ARTRALGIA\", \"PETEQUIA_N\", \n            \"LEUCOPENIA\", \"LACO\", \"DOR_RETRO\", \n            \"DIABETES\", \"HEMATOLOG\", \"HEPATOPAT\", \n            \"HEPATOPAT\", \"RENAL\", \"HIPERTENSA\",\n            \"ACIDO_PEPT\", \"AUTO_IMUNE\")\n\n# Prepare data\nchik <- arrow::open_dataset(sources = files_list) %>%\n  # Select variables\n  select(all_of(c(\"CLASSI_FIN\", \"COMUNINF\", \"IDADEanos\", \"DT_SIN_PRI\", x_vars))) %>%\n  # Filter out \"Inconclusivo\" cases\n  filter(CLASSI_FIN != \"Inconclusivo\") %>%\n  # Collect data from parquet files\n  collect() %>%\n  # Prepare variables\n  mutate(CLASSI_FIN = case_when(\n    CLASSI_FIN != \"Descartado\" ~ \"Chikungunya\",\n    .default = \"Discarded\"\n  )) %>%\n  mutate(CLASSI_FIN = as.factor(CLASSI_FIN)) %>%\n  mutate(DT_SIN_PRI = as_date(DT_SIN_PRI)) %>%\n  mutate(COMUNINF = as.factor(COMUNINF)) %>%\n  mutate_at(.vars = x_vars, .funs = ~ . == \"Sim\") \n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: There was 1 warning in `mutate()`.\nâ„¹ In argument: `DT_SIN_PRI = as_date(DT_SIN_PRI)`.\nCaused by warning:\n!  2 failed to parse.\n```\n:::\n:::\n\n\n\n\n## Session info\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.2 (2023-10-31)\nPlatform: x86_64-pc-linux-gnu (64-bit)\nRunning under: Ubuntu 22.04.3 LTS\n\nMatrix products: default\nBLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0 \nLAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0\n\nlocale:\n [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              \n [3] LC_TIME=en_CA.UTF-8        LC_COLLATE=en_US.UTF-8    \n [5] LC_MONETARY=en_CA.UTF-8    LC_MESSAGES=en_US.UTF-8   \n [7] LC_PAPER=en_CA.UTF-8       LC_NAME=C                 \n [9] LC_ADDRESS=C               LC_TELEPHONE=C            \n[11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C       \n\ntime zone: Europe/Paris\ntzcode source: system (glibc)\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] vip_0.4.1          tictoc_1.2         bonsai_0.2.1       finetune_1.1.0    \n [5] yardstick_1.3.0    workflowsets_1.0.1 workflows_1.1.3    tune_1.1.2        \n [9] rsample_1.2.0      recipes_1.0.9      parsnip_1.1.1      modeldata_1.3.0   \n[13] infer_1.0.6        dials_1.2.0        scales_1.3.0       broom_1.0.5       \n[17] tidymodels_1.1.1   knitr_1.45         arrow_14.0.0.2     lubridate_1.9.3   \n[21] forcats_1.0.0      stringr_1.5.1      dplyr_1.1.4        purrr_1.0.2       \n[25] readr_2.1.5        tidyr_1.3.1        tibble_3.2.1       ggplot2_3.4.4     \n[29] tidyverse_2.0.0   \n\nloaded via a namespace (and not attached):\n [1] tidyselect_1.2.0    timeDate_4032.109   fastmap_1.1.1      \n [4] digest_0.6.34       rpart_4.1.23        timechange_0.3.0   \n [7] lifecycle_1.0.4     survival_3.5-7      magrittr_2.0.3     \n[10] compiler_4.3.2      rlang_1.1.3         tools_4.3.2        \n[13] utf8_1.2.4          yaml_2.3.8          data.table_1.15.0  \n[16] htmlwidgets_1.6.4   bit_4.0.5           DiceDesign_1.10    \n[19] withr_3.0.0         nnet_7.3-19         grid_4.3.2         \n[22] fansi_1.0.6         colorspace_2.1-0    future_1.33.1      \n[25] iterators_1.0.14    globals_0.16.2      MASS_7.3-60        \n[28] cli_3.6.2           rmarkdown_2.25      generics_0.1.3     \n[31] rstudioapi_0.15.0   future.apply_1.11.1 tzdb_0.4.0         \n[34] splines_4.3.2       assertthat_0.2.1    parallel_4.3.2     \n[37] vctrs_0.6.5         hardhat_1.3.1       Matrix_1.6-3       \n[40] jsonlite_1.8.8      hms_1.1.3           bit64_4.0.5        \n[43] listenv_0.9.1       foreach_1.5.2       gower_1.0.1        \n[46] glue_1.7.0          parallelly_1.36.0   codetools_0.2-19   \n[49] stringi_1.8.3       gtable_0.3.4        GPfit_1.0-8        \n[52] munsell_0.5.0       pillar_1.9.0        furrr_0.3.1        \n[55] htmltools_0.5.7     ipred_0.9-14        lava_1.7.3         \n[58] R6_2.5.1            lhs_1.1.6           evaluate_0.23      \n[61] lattice_0.22-5      backports_1.4.1     class_7.3-22       \n[64] Rcpp_1.0.12         prodlim_2023.08.28  xfun_0.41          \n[67] pkgconfig_2.0.3    \n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}