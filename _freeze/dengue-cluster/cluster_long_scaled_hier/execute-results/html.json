{
  "hash": "0dd5423be5c3c3acc781db48619f9bfa",
  "result": {
    "markdown": "---\ntitle: \"Hierarchical clustering\"\nsubtitle: \"with scaled cases\"\nauthor: \"Raphael Saldanha\"\ndate: last-modified\n---\n\n\nThis notebooks aims to explore hierarchical clustering of municipalities considering scaled dengue cases time series.\n\n## Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(arrow)\nlibrary(timetk)\nlibrary(dtwclust)\nlibrary(kableExtra)\nlibrary(tictoc)\n```\n:::\n\n\n## Load data\n\nLoad the bundled data (326 municipalities, pop $\\geq$ 100k inhab.) with standardized cases and keep only the municipality code, date and cases variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntdengue <- read_parquet(\"../tdengue.parquet\") %>%\n  select(mun, date, cases)\n```\n:::\n\n\n## Prepare data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntdengue <- tdengue %>%\n  mutate(mun = paste0(\"m_\", mun)) %>%\n  arrange(mun, date) %>%\n  pivot_wider(names_from = mun, values_from = cases) %>%\n  select(-date) %>%\n  t() %>%\n  tslist()\n```\n:::\n\n\n## Clustering\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntic()\nclust <- tsclust(\n  series = tdengue, \n  type = \"hierarchical\", \n  k = 5,\n  distance = \"dtw_basic\",\n  seed = 123,\n  control = hierarchical_control(method = \"average\")\n)\ntoc()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n36.361 sec elapsed\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggdendro::ggdendrogram(clust, size = .3, labels = F)\n```\n\n::: {.cell-output-display}\n![](cluster_long_scaled_hier_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Session info\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.2.0 (2022-04-22)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS 13.4\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRblas.0.dylib\nLAPACK: /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRlapack.dylib\n\nRandom number generation:\n RNG:     L'Ecuyer-CMRG \n Normal:  Inversion \n Sample:  Rejection \n \nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] tictoc_1.2       kableExtra_1.3.4 dtwclust_5.5.12  dtw_1.23-1      \n [5] proxy_0.4-27     timetk_2.8.3     arrow_12.0.1     lubridate_1.9.2 \n [9] forcats_1.0.0    stringr_1.5.0    dplyr_1.1.2      purrr_1.0.1     \n[13] readr_2.1.4      tidyr_1.3.0      tibble_3.2.1     ggplot2_3.4.2   \n[17] tidyverse_2.0.0 \n\nloaded via a namespace (and not attached):\n  [1] colorspace_2.1-0    ellipsis_0.3.2      class_7.3-22       \n  [4] modeltools_0.2-23   ggdendro_0.1.23     clue_0.3-64        \n  [7] rstudioapi_0.15.0   farver_2.1.1        listenv_0.9.0      \n [10] furrr_0.3.1         dials_1.2.0         ggrepel_0.9.3      \n [13] bit64_4.0.5         RSpectra_0.16-1     prodlim_2023.03.31 \n [16] fansi_1.0.4         xml2_1.3.5          codetools_0.2-19   \n [19] splines_4.2.0       knitr_1.43          jsonlite_1.8.7     \n [22] workflows_1.1.3     cluster_2.1.4       yardstick_1.2.0    \n [25] shiny_1.7.4.1       tune_1.1.1          httr_1.4.6         \n [28] compiler_4.2.0      assertthat_0.2.1    Matrix_1.5-4.1     \n [31] fastmap_1.1.1       cli_3.6.1           later_1.3.1        \n [34] htmltools_0.5.5     tools_4.2.0         gtable_0.3.3       \n [37] glue_1.6.2          reshape2_1.4.4      Rcpp_1.0.11        \n [40] DiceDesign_1.9      vctrs_0.6.3         svglite_2.1.1      \n [43] iterators_1.0.14    parsnip_1.1.0       timeDate_4022.108  \n [46] gower_1.0.1         xfun_0.39           globals_0.16.2     \n [49] rvest_1.0.3         timechange_0.2.0    mime_0.12          \n [52] lifecycle_1.0.3     future_1.33.0       MASS_7.3-60        \n [55] zoo_1.8-12          scales_1.2.1        ipred_0.9-14       \n [58] hms_1.1.3           promises_1.2.0.1    parallel_4.2.0     \n [61] yaml_2.3.7          rpart_4.1.19        stringi_1.7.12     \n [64] foreach_1.5.2       lhs_1.1.6           hardhat_1.3.0      \n [67] lava_1.7.2.1        systemfonts_1.0.4   rlang_1.1.1        \n [70] pkgconfig_2.0.3     rsample_1.1.1       evaluate_0.21      \n [73] lattice_0.21-8      labeling_0.4.2      recipes_1.0.6      \n [76] htmlwidgets_1.6.2   bit_4.0.5           tidyselect_1.2.0   \n [79] parallelly_1.36.0   plyr_1.8.8          magrittr_2.0.3     \n [82] R6_2.5.1            generics_0.1.3      pillar_1.9.0       \n [85] withr_2.5.0         xts_0.13.1          survival_3.5-5     \n [88] nnet_7.3-19         future.apply_1.11.0 utf8_1.2.3         \n [91] tzdb_0.4.0          rmarkdown_2.23      grid_4.2.0         \n [94] flexclust_1.4-1     data.table_1.14.8   webshot_0.5.5      \n [97] digest_0.6.33       xtable_1.8-4        httpuv_1.6.11      \n[100] RcppParallel_5.1.7  stats4_4.2.0        GPfit_1.0-8        \n[103] munsell_0.5.0       viridisLite_0.4.2   shinyjs_2.1.0      \n```\n:::\n:::\n",
    "supporting": [
      "cluster_long_scaled_hier_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}