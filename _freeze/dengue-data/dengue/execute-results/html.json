{
  "hash": "1b07c29e337ecfec6b1d8d9bbd76faff",
  "result": {
    "markdown": "---\ntitle: \"Raw files\"\nauthor: Raphael Saldanha\ndate: now\n---\n\n\n## Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\n# remotes::install_github(\"rfsaldanha/microdatasus\")\nlibrary(microdatasus)\nlibrary(arrow)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'arrow'\n\nThe following object is masked from 'package:lubridate':\n\n    duration\n\nThe following object is masked from 'package:utils':\n\n    timestamp\n```\n:::\n:::\n\n\n## Data download\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# for(a in 2011:2021){\n#   tmp <- fetch_datasus(\n#     year_start = a, year_end = a,\n#     information_system = \"SINAN-DENGUE\"\n#   )\n# \n#   write_parquet(x = tmp, sink = paste0(\"parquets_raw/raw_dengue_\", a, \".parquet\"))\n#   \n#   tmp <- process_sinan_dengue(data = tmp)\n#   \n#   write_parquet(x = tmp, sink = paste0(\"parquets/dengue_\", a, \".parquet\"))\n#   \n#   rm(tmp)\n# }\n```\n:::\n\n\n## Load\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue <- open_dataset(sources = \"parquets/\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue %>%\n  mutate(DT_SIN_PRI = as.Date(DT_SIN_PRI)) %>%\n  filter(DT_SIN_PRI >= as.Date(\"2011-01-01\") & DT_SIN_PRI < as.Date(\"2022-01-01\")) %>%\n  mutate(class2 = case_when(\n    CLASSI_FIN == \"Descartado\" ~ \"Descartado/Inconclusivo\",\n    CLASSI_FIN == \"Inconclusivo\" ~ \"Descartado/Inconclusivo\",\n    is.na(CLASSI_FIN) ~ \"In analysis\",\n    TRUE ~ \"Dengue\"\n  )) %>%\n  group_by(class2) %>%\n  summarise(freq = n()) %>%\n  ungroup() %>%\n  arrange(-freq) %>%\n  collect()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 2\n  class2                     freq\n  <chr>                     <int>\n1 Dengue                  8105663\n2 Descartado/Inconclusivo 7345760\n3 In analysis               69492\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- dengue %>%\n  mutate(DT_SIN_PRI = as.Date(DT_SIN_PRI)) %>%\n  filter(DT_SIN_PRI >= as.Date(\"2011-01-01\") & DT_SIN_PRI < as.Date(\"2022-01-01\")) %>%\n  mutate(class2 = case_when(\n    CLASSI_FIN == \"Descartado\" ~ \"Descartado/Inconclusivo\",\n    CLASSI_FIN == \"Inconclusivo\" ~ \"Descartado/Inconclusivo\",\n    is.na(CLASSI_FIN) ~ \"In analysis\",\n    TRUE ~ \"Dengue\"\n  )) %>%\n  collect() %>%\n  mutate(DT_SIN_PRI = lubridate::ceiling_date(x = DT_SIN_PRI, unit = \"month\")) %>%\n  group_by(DT_SIN_PRI, class2) %>%\n  summarise(freq = n()) %>%\n  ungroup() %>%\n  arrange(-freq) %>%\n  collect()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'DT_SIN_PRI'. You can override using the\n`.groups` argument.\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(res) +\n  aes(x = DT_SIN_PRI, fill = class2, weight = freq) +\n  geom_bar() +\n  scale_fill_hue(direction = 1) +\n  labs(fill = \"Classificação\") +\n  theme_minimal() +\n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](dengue_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "dengue_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}