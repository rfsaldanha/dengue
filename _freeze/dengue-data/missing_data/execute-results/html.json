{
  "hash": "df71b68de07a885541a981a859dfc226",
  "result": {
    "markdown": "---\ntitle: \"Missing data analysis\"\nauthor: Raphael Saldanha\ndate: last-modified\n---\n\n\nThis report presents a missing data analysis from the raw parquet files.\n\nConsidering the high number of variables, this report will use a subset of the most relevant ones for this research.\n\n## Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(arrow)\nlibrary(naniar)\nlibrary(knitr)\nlibrary(lubridate)\nsource(\"../functions.R\")\n```\n:::\n\n\n### Execution node\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnode_name()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"rfsaldanha\"\n```\n:::\n:::\n\n\n## Load data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimportant_vars <- c(\"ID_AGRAVO\", \"DT_NOTIFIC\", \"ID_UNIDADE\",\n                    \"DT_SIN_PRI\", \"CS_SEXO\", \"CS_GESTANT\",\n                    \"CS_RACA\", \"CS_ESCOL_N\", \"ID_MN_RESI\",\n                    \"COUFINF\", \"COMUNINF\", \"ID_OCUPA_N\",\n                    \"DT_SORO\", \"RESUL_SORO\", \"SOROTIPO\", \n                    \"CLASSI_FIN\", \"CRITERIO\", \"EVOLUCAO\",\n                    \"DT_OBITO\", \"HOSPITALIZ\", \"DT_INTERNA\")\n\ndengue_files_list <- c(\n  data_dir(\"dengue_data/parquets/dengue_2011.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2012.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2013.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2014.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2015.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2016.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2017.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2018.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2019.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2020.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2021.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2022.parquet\")\n)\n\ndengue <- open_dataset(sources = dengue_files_list) %>%\n  select(all_of(important_vars)) %>%\n  collect()\n```\n:::\n\n\n## Overall\n\nConsidering all records.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue %>% \n  miss_var_summary() %>%\n  kable(\n    format.args = list(big.mark = \".\", decimal.mark = \",\")\n  )\n```\n\n::: {.cell-output-display}\n|variable   |     n_miss|   pct_miss|\n|:----------|----------:|----------:|\n|DT_OBITO   | 16.931.460| 99,8552666|\n|SOROTIPO   | 16.882.644| 99,5673685|\n|DT_INTERNA | 16.483.024| 97,2105628|\n|DT_SORO    | 12.097.609| 71,3470647|\n|COMUNINF   | 10.641.748| 62,7609541|\n|COUFINF    | 10.610.594| 62,5772197|\n|HOSPITALIZ |  6.615.736| 39,0170772|\n|RESUL_SORO |  5.276.629| 31,1195370|\n|CS_ESCOL_N |  3.613.638| 21,3118530|\n|EVOLUCAO   |  3.242.780| 19,1246745|\n|CRITERIO   |  2.129.285| 12,5577074|\n|CS_RACA    |  1.291.206|  7,6150385|\n|ID_OCUPA_N |     94.322|  0,5562750|\n|CLASSI_FIN |     71.348|  0,4207832|\n|CS_GESTANT |      4.694|  0,0276834|\n|ID_MN_RESI |      2.319|  0,0136766|\n|ID_UNIDADE |      1.817|  0,0107160|\n|CS_SEXO    |        777|  0,0045824|\n|DT_SIN_PRI |        224|  0,0013211|\n|ID_AGRAVO  |          0|  0,0000000|\n|DT_NOTIFIC |          0|  0,0000000|\n:::\n:::\n\n\n### Variables quality\n\n#### Residence municipality: ID_MN_RESI\n\nCheck var length. 6 characters are expected.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue %>%\n  mutate(\n    ID_MN_RESI_check = if_else(nchar(ID_MN_RESI) == 6, \n                               false = FALSE,\n                               true = TRUE)\n  ) %>%\n  group_by(ID_MN_RESI_check) %>%\n  summarise(freq = n()) %>%\n  ungroup() %>%\n  kable(\n    format.args = list(big.mark = \".\", decimal.mark = \",\")\n  )\n```\n\n::: {.cell-output-display}\n|ID_MN_RESI_check |       freq|\n|:----------------|----------:|\n|FALSE            |          4|\n|TRUE             | 16.953.678|\n|NA               |      2.319|\n:::\n:::\n\n\n42.658.908 records on the database meets the criteria. 8 records have invalid municipalty codes and this information is missing for 5.361 records. Inputation from COMUNINF is a possibility.\n\n#### Final classification of the notification: CLASSI_FIN\n\nIt is expected that the notifications final classification are labeled.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue %>%\n  group_by(CLASSI_FIN) %>%\n  summarise(freq = n()) %>%\n  ungroup() %>%\n  kable(\n    format.args = list(big.mark = \".\", decimal.mark = \",\")\n  )\n```\n\n::: {.cell-output-display}\n|CLASSI_FIN                   |      freq|\n|:----------------------------|---------:|\n|6                            |         3|\n|Dengue                       | 6.888.189|\n|Dengue clássico              | 2.346.272|\n|Dengue com complicações      |    18.969|\n|Dengue com sinais de alarme  |   101.062|\n|Dengue grave                 |     8.931|\n|Descartado                   | 5.364.096|\n|Febre hemorrágica do dengue  |     5.307|\n|Inconclusivo                 | 2.151.527|\n|Síndrome do choque do dengue |       297|\n|NA                           |    71.348|\n:::\n:::\n\n\nSeveral records have invalid labels and 4.841.110 are missing. This missing data may be from two causes: (1) the notification is being evaluated or (2) a real missing.\n\n#### Date of the first symptons onset: DT_SIN_PRI\n\nThis is the date most near to the infection date and more relevant to epidemiological analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvalid_interval <- interval(ymd(\"2001-01-01\"), ymd(\"2022-12-31\"))\n\ndengue %>%\n  mutate(\n    DT_SIN_PRI_check = ymd(DT_SIN_PRI) %within% valid_interval\n  ) %>%\n  group_by(DT_SIN_PRI_check) %>%\n  summarise(freq = n()) %>%\n  ungroup() %>%\n  kable(\n    format.args = list(big.mark = \".\", decimal.mark = \",\")\n  )\n```\n\n::: {.cell-output-display}\n|DT_SIN_PRI_check |       freq|\n|:----------------|----------:|\n|FALSE            |     25.826|\n|TRUE             | 16.929.951|\n|NA               |        224|\n:::\n:::\n\n\nThis variable is missing for 228 records. For 38.197 records, we have invalid dates (outside the period 2001-2023). It is possible to imputate with DT_NOTIFIC (date of notification), if valid.\n\n## Session info\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.2 (2023-10-31)\nPlatform: x86_64-pc-linux-gnu (64-bit)\nRunning under: Ubuntu 22.04.4 LTS\n\nMatrix products: default\nBLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0 \nLAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0\n\nlocale:\n [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              \n [3] LC_TIME=en_CA.UTF-8        LC_COLLATE=en_US.UTF-8    \n [5] LC_MONETARY=en_CA.UTF-8    LC_MESSAGES=en_US.UTF-8   \n [7] LC_PAPER=en_CA.UTF-8       LC_NAME=C                 \n [9] LC_ADDRESS=C               LC_TELEPHONE=C            \n[11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C       \n\ntime zone: Europe/Paris\ntzcode source: system (glibc)\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] knitr_1.45      naniar_1.0.0    arrow_14.0.0.2  lubridate_1.9.3\n [5] forcats_1.0.0   stringr_1.5.1   dplyr_1.1.4     purrr_1.0.2    \n [9] readr_2.1.5     tidyr_1.3.1     tibble_3.2.1    ggplot2_3.4.4  \n[13] tidyverse_2.0.0\n\nloaded via a namespace (and not attached):\n [1] bit_4.0.5         gtable_0.3.4      jsonlite_1.8.8    compiler_4.3.2   \n [5] visdat_0.6.0      tidyselect_1.2.0  assertthat_0.2.1  scales_1.3.0     \n [9] yaml_2.3.8        fastmap_1.1.1     R6_2.5.1          generics_0.1.3   \n[13] htmlwidgets_1.6.4 munsell_0.5.0     pillar_1.9.0      tzdb_0.4.0       \n[17] rlang_1.1.3       utf8_1.2.4        stringi_1.8.3     xfun_0.42        \n[21] bit64_4.0.5       timechange_0.3.0  cli_3.6.2         withr_3.0.0      \n[25] magrittr_2.0.3    digest_0.6.34     grid_4.3.2        hms_1.1.3        \n[29] lifecycle_1.0.4   vctrs_0.6.5       evaluate_0.23     glue_1.7.0       \n[33] fansi_1.0.6       colorspace_2.1-0  rmarkdown_2.25    tools_4.3.2      \n[37] pkgconfig_2.0.3   htmltools_0.5.7  \n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}