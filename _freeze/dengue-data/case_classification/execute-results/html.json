{
  "hash": "e506974854f8d7fe812335446dd28e02",
  "result": {
    "markdown": "---\ntitle: \"Case classification analysis\"\nauthor: Raphael Saldanha\ndate: last-modified\n---\n\n\nThis is a descriptive report about dengue case classification and criteria.\n\n## Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(arrow)\nlibrary(knitr)\nlibrary(lubridate)\nsource(\"../functions.R\")\n```\n:::\n\n\n### Execution node\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnode_name()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"rfsaldanha\"\n```\n:::\n:::\n\n\n## Load data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimportant_vars <- c(\"DT_SIN_PRI\", \"RESUL_SORO\", \"SOROTIPO\", \"CLASSI_FIN\", \"CRITERIO\")\n\nvalid_interval <- interval(ymd(\"2011-01-01\"), ymd(\"2022-12-31\"))\n\ndengue_files_list <- c(\n  data_dir(\"dengue_data/parquets/dengue_2011.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2012.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2013.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2014.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2015.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2016.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2017.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2018.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2019.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2020.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2021.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2022.parquet\"),\n  data_dir(\"dengue_data/parquets/dengue_2023.parquet\")\n)\n\ndengue <- open_dataset(sources = dengue_files_list) %>%\n  select(all_of(important_vars)) %>%\n  collect() %>%\n  mutate(DT_SIN_PRI = ymd(DT_SIN_PRI)) %>%\n  filter(DT_SIN_PRI %within% valid_interval) %>%\n  filter(CLASSI_FIN != \"6\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: There was 1 warning in `mutate()`.\nℹ In argument: `DT_SIN_PRI = ymd(DT_SIN_PRI)`.\nCaused by warning:\n!  1 failed to parse.\n```\n:::\n:::\n\n\n## Final classification and criteria\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue %>%\n  group_by(CLASSI_FIN, CRITERIO) %>%\n  summarise(freq = n()) %>%\n  ungroup() %>%\n  kable(\n    format.args = list(big.mark = \".\", decimal.mark = \",\")\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'CLASSI_FIN'. You can override using the\n`.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n|CLASSI_FIN                   |CRITERIO               |      freq|\n|:----------------------------|:----------------------|---------:|\n|Dengue                       |Clínico epidemiológico | 4.177.315|\n|Dengue                       |Em investigação        |    69.140|\n|Dengue                       |Laboratório            | 2.636.698|\n|Dengue                       |NA                     |        24|\n|Dengue clássico              |Clínico epidemiológico | 1.439.136|\n|Dengue clássico              |Em investigação        |    16.796|\n|Dengue clássico              |Laboratório            |   880.966|\n|Dengue clássico              |NA                     |         7|\n|Dengue com complicações      |Clínico epidemiológico |     8.249|\n|Dengue com complicações      |Em investigação        |       595|\n|Dengue com complicações      |Laboratório            |     9.973|\n|Dengue com sinais de alarme  |Clínico epidemiológico |    50.785|\n|Dengue com sinais de alarme  |Em investigação        |     2.555|\n|Dengue com sinais de alarme  |Laboratório            |    47.710|\n|Dengue grave                 |Clínico epidemiológico |     1.776|\n|Dengue grave                 |Em investigação        |       488|\n|Dengue grave                 |Laboratório            |     6.672|\n|Descartado                   |Clínico epidemiológico | 2.498.546|\n|Descartado                   |Em investigação        |     9.386|\n|Descartado                   |Laboratório            | 2.850.290|\n|Descartado                   |NA                     |        26|\n|Febre hemorrágica do dengue  |Clínico epidemiológico |         2|\n|Febre hemorrágica do dengue  |Em investigação        |       230|\n|Febre hemorrágica do dengue  |Laboratório            |     5.041|\n|Inconclusivo                 |Clínico epidemiológico |    19.693|\n|Inconclusivo                 |Em investigação        |    63.011|\n|Inconclusivo                 |Laboratório            |     8.658|\n|Inconclusivo                 |NA                     | 2.053.618|\n|Síndrome do choque do dengue |Clínico epidemiológico |         5|\n|Síndrome do choque do dengue |Em investigação        |        17|\n|Síndrome do choque do dengue |Laboratório            |       273|\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue_classifications <- c(\"Febre hemorrágica do dengue\", \"Síndrome do choque do dengue\", \"Dengue com sinais de alarme\",\n  \"Dengue clássico\", \"Dengue com complicações\", \"Dengue\",\n  \"Dengue grave\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue_cases_classification <- dengue %>% \n  mutate(CLASSI_FIN = case_when(\n    CLASSI_FIN %in% dengue_classifications ~ \"Confirmed\",\n    CLASSI_FIN == \"Descartado\" ~ \"Discarded\",\n    CLASSI_FIN == \"Inconclusivo\" ~ \"Inconclusive\",\n    CLASSI_FIN == 6 ~ \"Invalid\",\n    is.na(CLASSI_FIN) ~ \"Missing\",\n    .default = CLASSI_FIN\n  )) %>%\n  mutate(DT_SIN_PRI = lubridate::ceiling_date(x = DT_SIN_PRI, unit = \"month\")) %>%\n  group_by(DT_SIN_PRI, CLASSI_FIN) %>%\n  summarise(freq = n()) %>%\n  ungroup() \n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'DT_SIN_PRI'. You can override using the\n`.groups` argument.\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_parquet(x = dengue_cases_classification, sink = data_dir(\"dengue_data/parquet_classification/dengue_cases_classification.parquet\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data =  dengue_cases_classification, aes(x = DT_SIN_PRI, weight = freq, fill = CLASSI_FIN)) +\n  geom_bar() +\n  scale_fill_hue(direction = 1) +\n  scale_y_continuous(labels = scales::comma) +\n  labs(fill = \"Classificação\") +\n  theme_minimal() +\n  theme(legend.position = \"bottom\") +\n  labs(x = \"Month of first symptom's onset\", y = \"Records\", fill = \"Classification\")\n```\n\n::: {.cell-output-display}\n![](case_classification_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(filename = \"dengue_cases_classification.pdf\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSaving 7 x 5 in image\n```\n:::\n:::\n\n\n## Sorological examination\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue %>%\n  filter(CLASSI_FIN %in% dengue_classifications) %>%\n  group_by(SOROTIPO) %>%\n  summarise(freq = n()) %>%\n  ungroup()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 2\n  SOROTIPO    freq\n  <chr>      <int>\n1 DEN 1      46808\n2 DEN 2      18904\n3 DEN 3        213\n4 DEN 4       6141\n5 <NA>     9282387\n```\n:::\n:::\n\n\n## Session info\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.2 (2023-10-31)\nPlatform: x86_64-pc-linux-gnu (64-bit)\nRunning under: Ubuntu 22.04.4 LTS\n\nMatrix products: default\nBLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0 \nLAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0\n\nlocale:\n [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              \n [3] LC_TIME=en_CA.UTF-8        LC_COLLATE=en_US.UTF-8    \n [5] LC_MONETARY=en_CA.UTF-8    LC_MESSAGES=en_US.UTF-8   \n [7] LC_PAPER=en_CA.UTF-8       LC_NAME=C                 \n [9] LC_ADDRESS=C               LC_TELEPHONE=C            \n[11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C       \n\ntime zone: Europe/Paris\ntzcode source: system (glibc)\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] knitr_1.45      arrow_14.0.0.2  lubridate_1.9.3 forcats_1.0.0  \n [5] stringr_1.5.1   dplyr_1.1.4     purrr_1.0.2     readr_2.1.5    \n [9] tidyr_1.3.1     tibble_3.2.1    ggplot2_3.4.4   tidyverse_2.0.0\n\nloaded via a namespace (and not attached):\n [1] bit_4.0.5         gtable_0.3.4      jsonlite_1.8.8    compiler_4.3.2   \n [5] tidyselect_1.2.0  assertthat_0.2.1  textshaping_0.3.7 systemfonts_1.0.5\n [9] scales_1.3.0      yaml_2.3.8        fastmap_1.1.1     R6_2.5.1         \n[13] labeling_0.4.3    generics_0.1.3    htmlwidgets_1.6.4 munsell_0.5.0    \n[17] pillar_1.9.0      tzdb_0.4.0        rlang_1.1.3       utf8_1.2.4       \n[21] stringi_1.8.3     xfun_0.42         bit64_4.0.5       timechange_0.3.0 \n[25] cli_3.6.2         withr_3.0.0       magrittr_2.0.3    digest_0.6.34    \n[29] grid_4.3.2        hms_1.1.3         lifecycle_1.0.4   vctrs_0.6.5      \n[33] evaluate_0.23     glue_1.7.0        farver_2.1.1      ragg_1.2.7       \n[37] fansi_1.0.6       colorspace_2.1-0  rmarkdown_2.25    tools_4.3.2      \n[41] pkgconfig_2.0.3   htmltools_0.5.7  \n```\n:::\n:::\n",
    "supporting": [
      "case_classification_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}