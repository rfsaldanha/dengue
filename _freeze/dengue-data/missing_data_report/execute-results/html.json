{
  "hash": "732fc7d24a56cfedf733b7a1dd216b51",
  "result": {
    "markdown": "---\ntitle: \"Dengue missing data report\"\nformat: html\neditor: visual\nauthor: Raphael Saldanha\ntheme: cosmo\ndate: \"2023-06-13\"\n---\n\n\n## Context\n\nThis report presents an missing data analysis for Brazilian dengue data, from the SINAN dataset, downloaded from the DataSUS FTP, covering the years from 2011 to 2021.\n\nAfter the download, the data was pre-processed by using the `microdatasus` package as presented on the `dengue.qmd` report.\n\nConsidering the high number of variables, this report will use a subset of the most relevant ones.\n\n## Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(arrow)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'arrow'\n\nThe following object is masked from 'package:lubridate':\n\n    duration\n\nThe following object is masked from 'package:utils':\n\n    timestamp\n```\n:::\n\n```{.r .cell-code}\nlibrary(naniar)\nlibrary(knitr)\nlibrary(lubridate)\n```\n:::\n\n\n## Load data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimportant_vars <- c(\"ID_AGRAVO\", \"DT_NOTIFIC\", \"ID_UNIDADE\",\n                    \"DT_SIN_PRI\", \"CS_SEXO\", \"CS_GESTANT\",\n                    \"CS_RACA\", \"CS_ESCOL_N\", \"ID_MN_RESI\",\n                    \"COUFINF\", \"COMUNINF\", \"ID_OCUPA_N\",\n                    \"DT_SORO\", \"RESUL_SORO\", \"SOROTIPO\", \n                    \"CLASSI_FIN\", \"CRITERIO\", \"EVOLUCAO\",\n                    \"DT_OBITO\", \"HOSPITALIZ\", \"DT_INTERNA\")\n\ndengue <- open_dataset(sources = \"parquets/\") %>%\n  select(all_of(important_vars)) %>%\n  collect()\n```\n:::\n\n\n## Overall\n\nPlot with a 0.2% random sample (31,124 out from 15,562,124 records).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue %>%\n  slice_sample(prop = 0.002) %>%\n  vis_miss()\n```\n\n::: {.cell-output-display}\n![](missing_data_report_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nTable considering all records.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue %>% \n  miss_var_summary() %>%\n  kable(\n    format.args = list(big.mark = \".\", decimal.mark = \",\")\n  )\n```\n\n::: {.cell-output-display}\n|variable   |     n_miss|   pct_miss|\n|:----------|----------:|----------:|\n|DT_OBITO   | 19.153.998| 99,8620523|\n|SOROTIPO   | 19.122.145| 99,6959822|\n|DT_INTERNA | 18.666.361| 97,3196885|\n|DT_SORO    | 13.240.413| 69,0307483|\n|COUFINF    | 12.135.027| 63,2676635|\n|COMUNINF   | 11.092.216| 57,8308223|\n|HOSPITALIZ |  9.873.619| 51,4774961|\n|RESUL_SORO |  7.430.672| 38,7408496|\n|EVOLUCAO   |  6.002.490| 31,2948226|\n|CS_ESCOL_N |  5.838.882| 30,4418294|\n|CRITERIO   |  4.529.680| 23,6161213|\n|CS_RACA    |  3.700.530| 19,2932316|\n|CLASSI_FIN |  2.402.459| 12,5255566|\n|CS_GESTANT |  2.304.926| 12,0170547|\n|CS_SEXO    |  2.301.330| 11,9983064|\n|ID_OCUPA_N |    720.520|  3,7565320|\n|ID_UNIDADE |      3.471|  0,0180965|\n|ID_MN_RESI |      2.627|  0,0136962|\n|DT_SIN_PRI |        176|  0,0009176|\n|DT_NOTIFIC |          1|  0,0000052|\n|ID_AGRAVO  |          0|  0,0000000|\n:::\n:::\n\n\n### Variables quality\n\n#### Residence municipality: ID_MN_RESI\n\nCheck var length. 6 characters are expected.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue %>%\n  mutate(\n    ID_MN_RESI_check = if_else(nchar(ID_MN_RESI) == 6, \n                               false = FALSE,\n                               true = TRUE)\n  ) %>%\n  group_by(ID_MN_RESI_check) %>%\n  summarise(freq = n()) %>%\n  ungroup() %>%\n  kable(\n    format.args = list(big.mark = \".\", decimal.mark = \",\")\n  )\n```\n\n::: {.cell-output-display}\n|ID_MN_RESI_check |       freq|\n|:----------------|----------:|\n|FALSE            |          4|\n|TRUE             | 19.177.826|\n|NA               |      2.627|\n:::\n:::\n\n\n15.559.994 records on the database meets the criteria. 4 records have invalid municipalty codes and this information is missing for 2.126 records. Inputation from COMUNINF is a possibility.\n\n#### Final classification of the notification: CLASSI_FIN\n\nIt is expected that the notifications final classification are labeled.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue %>%\n  group_by(CLASSI_FIN) %>%\n  summarise(freq = n()) %>%\n  ungroup() %>%\n  kable(\n    format.args = list(big.mark = \".\", decimal.mark = \",\")\n  )\n```\n\n::: {.cell-output-display}\n|CLASSI_FIN                   |      freq|\n|:----------------------------|---------:|\n|1                            |   308.012|\n|2                            |     7.962|\n|3                            |     2.588|\n|4                            |        91|\n|5                            |   189.158|\n|6                            |         3|\n|8                            |    75.360|\n|Dengue                       | 5.665.033|\n|Dengue clássico              | 2.686.548|\n|Dengue com complicações      |    23.073|\n|Dengue com sinais de alarme  |    82.408|\n|Dengue grave                 |     7.391|\n|Descartado                   | 5.580.603|\n|Febre hemorrágica do dengue  |     7.136|\n|Inconclusivo                 | 2.142.252|\n|Síndrome do choque do dengue |       380|\n|NA                           | 2.402.459|\n:::\n:::\n\n\n3 records have an invalid label and 69.866 are missing. This missing data may be from two causes: (1) the notification is being evaluated or (2) a real missing.\n\n#### Date of the first symptons onset: DT_SIN_PRI\n\nThis is the date most near to the infection date and more relevant to epidemiological analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvalid_interval <- interval(ymd(\"2001-01-01\"), ymd(\"2021-12-31\"))\n\ndengue %>%\n  mutate(\n    DT_SIN_PRI_check = ymd(DT_SIN_PRI) %within% valid_interval\n  ) %>%\n  group_by(DT_SIN_PRI_check) %>%\n  summarise(freq = n()) %>%\n  ungroup() %>%\n  kable(\n    format.args = list(big.mark = \".\", decimal.mark = \",\")\n  )\n```\n\n::: {.cell-output-display}\n|DT_SIN_PRI_check |       freq|\n|:----------------|----------:|\n|FALSE            |     30.775|\n|TRUE             | 19.149.506|\n|NA               |        176|\n:::\n:::\n\n\nThis variable is missing for 173 records. For 26.018 records, we have invalid dates (outside the period 2001-2021). It is possible to imputate with DT_NOTIFIC (date of notification), if valid.\n\n## Session info\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.1.2 (2021-11-01)\nPlatform: x86_64-pc-linux-gnu (64-bit)\nRunning under: Ubuntu 22.04.2 LTS\n\nMatrix products: default\nBLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0\nLAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0\n\nlocale:\n [1] LC_CTYPE=pt_BR.UTF-8       LC_NUMERIC=C              \n [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    \n [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   \n [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 \n [9] LC_ADDRESS=C               LC_TELEPHONE=C            \n[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       \n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] knitr_1.43      naniar_1.0.0    arrow_12.0.0    lubridate_1.9.2\n [5] forcats_1.0.0   stringr_1.5.0   dplyr_1.1.2     purrr_1.0.1    \n [9] readr_2.1.4     tidyr_1.3.0     tibble_3.2.1    ggplot2_3.4.2  \n[13] tidyverse_2.0.0\n\nloaded via a namespace (and not attached):\n [1] compiler_4.1.2    pillar_1.9.0      tools_4.1.2       bit_4.0.5        \n [5] digest_0.6.31     timechange_0.2.0  jsonlite_1.8.5    evaluate_0.21    \n [9] lifecycle_1.0.3   gtable_0.3.3      pkgconfig_2.0.3   rlang_1.1.1      \n[13] cli_3.6.1         rstudioapi_0.14   yaml_2.3.7        xfun_0.39        \n[17] fastmap_1.1.1     withr_2.5.0       generics_0.1.3    vctrs_0.6.2      \n[21] htmlwidgets_1.6.2 hms_1.1.3         bit64_4.0.5       grid_4.1.2       \n[25] tidyselect_1.2.0  glue_1.6.2        R6_2.5.1          fansi_1.0.4      \n[29] rmarkdown_2.22    farver_2.1.1      tzdb_0.4.0        magrittr_2.0.3   \n[33] scales_1.2.1      htmltools_0.5.5   visdat_0.6.0      assertthat_0.2.1 \n[37] colorspace_2.1-0  labeling_0.4.2    utf8_1.2.3        stringi_1.7.12   \n[41] munsell_0.5.0    \n```\n:::\n:::\n",
    "supporting": [
      "missing_data_report_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}